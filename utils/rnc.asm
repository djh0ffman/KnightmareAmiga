*------------------------------------------------------------------------------
* Low Level Read/Write/Format Disk Code for Commodore Amiga Dos Disks
*
* Copyright (c) 1988-93 Rob Northen Computing, U.K. All Rights Reserved.
*
* File: DISKIO.S (TIMER-A, CIA-A VERSION)
*
* Date: 08-NOV-93
*------------------------------------------------------------------------------

*------------------------------------------------------------------------------
* Low Level Read/Write/Format Disk Code for AmigaDos Disks
* on entry,
*	d0.w = drive number
*		0 = DF0
*		1 = DF1
*		2 = DF2
*		3 = DF3
*		4 = DF0, side 0 only
*		5 = DF1, side 0 only
*		6 = DF2, side 0 only
*		7 = DF3, side 0 only
*	d1.w = start sector no.
*		(0-879 for single sided disk, 0-1759 for double sided disk)
*	d2.w = number of sectors to read/write
*		0 = turn motor off (bit 15 of d3 must be set)
*	d3.w = function
*		0 = read sectors
*		1 = write sectors
*		2 = format track
*			a0.l = address of sector data, or 0
*			a1.l = address of $3300 byte buffer
*			d1.w = sector no. of track to format
*			       ie. 0=track 0, side 0
*			          11=track 0, side 1 or track 1, side 0
*				  depending upon d0.w
*			d2.w = sectors to format
*			       ie.11=1 track
*			          22=2 tracks
*		3 = find which drive(s) attached, result returned in d0.b 
*			bit 0 : 0 = no DF0:, 1 = DF0: present
*			bit 1 : 0 = no DF1:, 1 = DF1: present
*			bit 2 : 0 = no DF2:, 1 = DF2: present
*			bit 3 : 0 = no DF3:, 1 = DF3: present
*	bit 15 of d3.w controls whether the drive motor is turned off
*	after use. If bit 15 is clear the drive motor is left on. If
*	bit 15 is set the drive motor is turned off. Leave the drive
*	motor on if another disk operation is to be made soon after
*	the current one.
*
*	a0.l = disk buffer address for transfer
*	a1.l = workspace buffer, ($3300 bytes of CHIPMEM required)
* on exit,
*	d0.l = error no., if d0.l <> 0 then d1.l = sector offset in error
*		00 = no error
*		21 = No Sector Header
*		22 = Bad Sector Preamble
*		23 = Bad Sector ID
*		24 = Bad Sector Header Checksum
*		25 = Bad Sector Sum
*		26 = Too Few Sectors
*		27 = Bad Sector Header
*		28 = Write Protected
*		29 = No Disk in Drive
*		30 = Seek Error
*		34 = Drive In Use
*		-1 = DMA timeout
*
* Note: The disk code uses Timer A of CIA A
*	The blitter is not used
*------------------------------------------------------------------------------
  even
diskio:
  dc.l    $48E77FFC,$4E56FFDC,$B67C0003,$66086100,$00F46000,$00E63800,$02440003,$3D44FFDC
  dc.l    $3D41FFDE,$3D42FFE0,$3D43FFE2,$2D48FFE4,$2D49FFE8,$E4580240,$00015240,$3D40FFEC
  dc.l    $70003602,$6700008A,$701ED641,$B67C06E0,$6E0000A8,$02810000,$FFFF82FC,$000B0C6E
  dc.l    $0001FFEC,$6702D241,$3D41FFEE,$48413D41,$FFF06100,$06804A2E,$FFE36704,$610004EA
  dc.l    $302EFFF0,$720B9240,$B26EFFE0,$6F04322E,$FFE03D41,$FFF26100,$00C86634,$4A2EFFE3
  dc.l    $67066100,$01AC6628,$302EFFE0,$906EFFF2,$671E3D40,$FFE0302E,$FFF2E188,$D080D1AE
  dc.l    $FFE4426E,$FFF0302E,$FFECD16E,$FFEE60B0,$2F006100,$05F2201F,$67207200,$322EFFEE
  dc.l    $0C6E0001,$FFEC6702,$E249C2FC,$000BD26E,$FFF0D26E,$FFFA2F41,$00284E5E,$4A804CDF
  dc.l    $3FFE4E75,$3D7C0003,$FFDC7A01,$610005E6,$610005C2,$382EFFDC,$56446116,$B0BCFFFF
  dc.l    $FFFF6604,$574409C5,$536EFFDC,$66DE2005,$4E75761F,$7000610A,$D502D180,$51CBFFF8
  dc.l    $4E7572FF,$098113C1,$00BFD100,$08390005,$00BFE001,$57C209C1,$13C100BF,$D1004E75
  dc.l    $7802426E,$FFFC426E,$FFFA426E,$FFF8342E,$FFEE6100,$05986600,$00B8701D,$08390002
  dc.l    $00BFE001,$670000AA,$70000C2E,$0002FFE3,$670000BA,$2A6EFFE8,$4BED0400,$2ABCAAAA
  dc.l    $AAAA3B7C,$44890004,$61000348,$610001AA,$667E302E,$FFF4674E,$C0FC0440,$41ED0006
  dc.l    $6100048E,$49F900DF,$F01E6100,$01E46678,$0C2E0001,$FFE3670A,$302EFFFA,$906EFFF2
  dc.l    $676A2A6E,$FFE84BED,$0400302E,$FFF4C0FC,$0440DBC0,$2ABCAAAA,$AAAA3B7C,$44890004
  dc.l    $204D6100,$0402302E,$FFF66718,$C0FC0440,$41ED0006,$6100043A,$49EEFFFE,$42546100
  dc.l    $01906624,$302EFFFA,$906EFFF2,$671E701A,$2F007402,$610004D6,$61000520,$201F0839
  dc.l    $000200BF,$E0016704,$51CCFF18,$60000464,$7802426E,$FFFA0C2E,$0002FFE3,$660A302E
  dc.l    $FFEE206E,$FFE86170,$61000548,$70646100,$057C701C,$08390003,$00BFE001,$674E41F9
  dc.l    $00DFF000,$317C4000,$0024216E,$FFE80020,$317C6600,$009E317C,$9100009E,$0C6E0050
  dc.l    $FFEE6506,$317CA000,$009E317C,$82100096,$317C0002,$009C317C,$D9610024,$317CD961
  dc.l    $00246100,$03CA6704,$51CCFF9E,$2F007002,$6100051A,$201F4E75,$26000043,$FF004843
  dc.l    $363C000B,$2A6EFFE8,$4BED0400,$286EFFE4,$204D5848,$20FC4489,$44892003,$610002FE
  dc.l    $41E8FFF8,$61000300,$72286100,$02426100,$02EC41E8,$FFF86100,$02EE200C,$672A204C
  dc.l    $43ED0040,$203C0000,$02006100,$02A241ED,$0040323C,$04006100,$021641ED,$00386100
  dc.l    $02BCD9FC,$00000200,$DBFC0000,$04400643,$01005303,$669A4E75,$740A41ED,$0006303C
  dc.l    $00406100,$02EC6100,$03266636,$610001CC,$670651CA,$FFE6602C,$6100018A,$662AB26E
  dc.l    $FFEE6624,$B43C000B,$6C1EB63C,$000B6E18,$53033D43,$FFF43D7C,$000BFFF6,$976EFFF6
  dc.l    $70004E75,$70184E75,$701B4E75,$70194E75,$2A6EFFE8,$4BED0400,$302EFFF8,$C0FC0440
  dc.l    $DBC0203C,$00001770,$61000442,$082C0001,$00016600,$00F66100,$04266700,$00F24AAD
  dc.l    $044067E8,$61000154,$66BA6100,$011866B8,$B26EFFEE,$66B23602,$41ED0008,$61000126
  dc.l    $103C000B,$902EFFF9,$41ED0008,$610001EE,$61000136,$41ED0030,$610001E2,$B66EFFF0
  dc.l    $6D00009A,$302EFFF2,$D06EFFF0,$B6406C00,$008C082C,$00010001,$66000090,$302EFFFC
  dc.l    $07006678,$4A2EFFE3,$67326100,$0086206E,$FFE4D1C1,$43ED0040,$61000174,$082C0001
  dc.l    $00016666,$41ED0040,$323C0400,$610000E0,$41ED0038,$61000186,$61686040,$41ED0040
  dc.l    $323C0400,$610000C8,$2F0041ED,$00386100,$0094B09F,$6600FF16,$082C0001,$0001662A
  dc.l    $613041ED,$0040226E,$FFE4D3C1,$610000F8,$6130302E,$FFFAB06E,$FFF2670E,$526EFFF8
  dc.l    $0C6E000B,$FFF86600,$FEE87000,$4E7570FF,$4E752203,$926EFFF0,$203C0000,$0200C2C0
  dc.l    $4E75302E,$FFFC07C0,$3D40FFFC,$526EFFFA,$4E75204D,$720A7000,$41E80440,$208051C9
  dc.l    $FFF84E75,$41ED0008,$611A3600,$024300FF,$3400E04A,$48403200,$024100FF,$E048B03C
  dc.l    $00FF4E75,$20182218,$02805555,$55550281,$55555555,$D0808081,$4E75610C,$2F0041ED
  dc.l    $003061E0,$B09F4E75,$41ED0008,$72282F02,$E4495341,$70002418,$B58051C9,$FFFA241F
  dc.l    $02805555,$55554E75,$206EFFE8,$203CAAAA,$AAAA2200,$24002600,$28002A00,$2C002E00
  dc.l    $43E80400,$0C2E0001,$FFE36704,$43E832C0,$48E1FF00,$B1C966F8,$4E750839,$000600DF
  dc.l    $F00266F6,$4E7548E7,$F0E0707F,$45E80200,$263C5555,$55552218,$241AC283,$C483D281
  dc.l    $828222C1,$51C8FFF0,$4CDF070F,$4E7548E7,$FCC0C348,$2600E48B,$53832A00,$2011E288
  dc.l    $61422019,$41F058FC,$613A91C5,$51CBFFEE,$6114D1C5,$61104CDF,$033F4E75,$2F00E288
  dc.l    $6122201F,$611E1010,$08280000,$FFFF660C,$08000006,$660C08C0,$00076004,$08800007
  dc.l    $10804E75,$02805555,$55552400,$0A825555,$55552202,$D482E289,$08C1001F,$C2828081
  dc.l    $08280000,$FFFF6704,$0880001F,$20C04E75,$43F900DF,$F000337C,$40000024,$337C8210
  dc.l    $0096337C,$6600009E,$337C9500,$009E337C,$4489007E,$23480020,$337C0002,$009CE248
  dc.l    $00408000,$33400024,$33400024,$4E7543F9,$00DFF000,$203C0000,$09C46100,$01700829
  dc.l    $0001001F,$660A6100,$015666F2,$70FF6002,$700033FC,$000200DF,$F09C33FC,$400000DF
  dc.l    $F0244A80,$4E7533FC,$040000DF,$F09E4A6E,$FFE26A1E,$72FF13C1,$00BFD100,$302EFFDC
  dc.l    $56800181,$13C100BF,$D10001C1,$13C100BF,$D1004E75,$72FF13C1,$00BFD100,$08810007
  dc.l    $61D4203C,$000000C8,$600000E2,$48E73000,$26026100,$009E302E,$FFDCD040,$41FA0108
  dc.l    $30300000,$6A046132,$662AE248,$E24A7201,$9440670E,$6A0472FF,$44427003,$61505342
  dc.l    $66F8302E,$FFDCD040,$41FA00DC,$31830000,$61607000,$4CDF000C,$4E7548E7,$20007455
  dc.l    $08390004,$00BFE001,$670E7003,$72FF611E,$51CAFFEE,$701E6010,$302EFFDC,$D04041FA
  dc.l    $00A64270,$00007000,$4CDF0004,$4E752F00,$612A4A01,$6B040880,$00010880,$000013C0
  dc.l    $00BFD100,$08C00000,$13C000BF,$D100201F,$603A6108,$13C000BF,$D1004E75,$48A76000
  dc.l    $302EFFDC,$143900BF,$D1000002,$007F5600,$01825700,$D040323B,$004E0801,$00006704
  dc.l    $08820002,$10024C9F,$00064E75,$611E0839,$000000BF,$EE0166F6,$538066F0,$4E750839
  dc.l    $000000BF,$EE01661C,$53806718,$13FC0008,$00BFEE01,$13FC00CC,$00BFE401,$13FC0002
  dc.l    $00BFE501,$4E75FFFF,$FFFFFFFF
  dc.w    $FFFF

